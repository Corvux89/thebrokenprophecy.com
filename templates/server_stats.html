{% extends "template.html" %} {% block body %}

<h1 class="stats_header">Broken Prophecy 2.0 Server Statistics </h1>
<p>Test data not live data</p>

<div class="stats-container m-2">
    <div class="d-grid gap-2 d-md-block mb-2">
        <a class="btn btn-primary stats_button" data-toggle="collapse" href="#raceCollapse" role="button">Races</a>
        <a class="btn btn-primary stats_button" data-toggle="collapse" href="#classCollapse" role="button">Classes</a>
        <a class="btn btn-primary stats_button" data-toggle="collapse" href="#factionCollapse" role="button">Factions</a>
    </div>

    <div class="collapse show" id="raceCollapse">
        <p class="text-white">* - Denotes an expandable/collapsible subrace table</p>
         <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle category-toggle mb-2" type="button" data-toggle="dropdown" aria-expanded="false" id="raceDropdown">Goto Race</button>
            <div class="dropdown-menu" aria-labelledby="raceDropdown">
                {% for race in race_data['races'] %}
                <a class="dropdown-item" href="#{{race.name}}">{{race.name}}</a>
                {% endfor %}
            </div>

             <button class="btn btn-light mb-2" id="subraceCollapse">Expand/Collapse all</button>
        </div>
        <table class="table table-dark table-condensed mb-0">
            <thead>
                <tr class="table-active">
                    <th class="total-row" scope="col">Total Players</th>
                    <th class="total-amount" scope="col">{{race_data['total']}}</th>
                </tr>
                <tr>
                    <th scope="col" class="columnLabel">Race</th>
                    <th scope="col" class="columnCount">#</th>
                </tr>
            </thead>
            <tbody>
                {% for race in race_data['races'] %}
                    {% if race['subraces'][0] != blank %}
                    <tr data-toggle="collapse" data-target="#{{race.name}}collapse" class="accordion-toggle" id="{{race.name}}">
                        <td class="label"><button class="btn btn-link btn-xs"><span class="race-name text-white">{{race.name}}*</span></button></td>
                        <td class="count">{{race.count}}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td class="label pl-4">{{race.name}}</td>
                        <td class="count">{{race.count}}</td>
                    </tr>
                    {% endif %}
                    {% if race['subraces'][0] != null %}
                        <tr>
                            <td colspan="1" class="hiddenRow p-0">
                                <div class="accordion-body collapse show subrace-collapse" id="{{race.name}}collapse">
                                    <table class="table table-secondary table-sm mb-0">
                                        <thead>
                                        <tr>
                                            <th scope="col" class="columnLabel">Subrace</th>
                                            <th scope="col" class="columnCount">#</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for subrace in race['subraces'] %}
                                        <tr>
                                            <td class="label">{{subrace.name}}</td>
                                            <td class="count">{{subrace.count}}</td>
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="collapse" id="classCollapse">
        <p class="text-white">* - Denotes an expandable/collapsible subclass table</p>
         <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle category-toggle mb-2" type="button" data-toggle="dropdown" aria-expanded="false" id="classDropdown">Goto Class</button>
            <div class="dropdown-menu" aria-labelledby="classDropdown">
                {% for class in class_data['classes'] %}
                <a class="dropdown-item" href="#{{class.name}}">{{class.name}}</a>
                {% endfor %}
            </div>

             <button class="btn btn-light mb-2" id="subclassCollapse">Expand/Collapse all</button>
        </div>
        <table class="table table-dark table-condensed mb-0">
            <thead>
                <tr>
                    <th scope="col" class="columnLabel">Class</th>
                    <th scope="col" class="columnCount">#</th>
                </tr>
            </thead>
            <tbody>
                {% for class in class_data['classes'] %}
                    {% if class['subclasses'][0] != blank %}
                    <tr data-toggle="collapse" data-target="#{{class.name}}collapse" class="accordion-toggle" id="{{class.name}}">
                        <td><button class="btn btn-link btn-xs"><span class="class-name text-white">{{class.name}}*</span></button></td>
                        <td>{{class.count}}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td class="label pl-4">{{class.name}}</td>
                        <td clas="count">{{class.count}}</td>
                    </tr>
                    {% endif %}
                    {% if class['subclasses'][0] != null %}
                        <tr>
                            <td colspan="1" class="hiddenRow p-0">
                                <div class="accordion-body collapse show subclass-collapse" id="{{class.name}}collapse">
                                    <table class="table table-secondary table-sm mb-0">
                                        <thead>
                                        <tr>
                                            <th scope="col" class="columnLabel">Subclass</th>
                                            <th scope="col" class="columnCount">#</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for subclass in class['subclasses'] %}
                                        <tr>
                                            <td>{{subclass.name}}</td>
                                            <td>{{subclass.count}}</td>
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="collapse" id="factionCollapse">
         <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle category-toggle mb-2" type="button" data-toggle="dropdown" aria-expanded="false" id="factionDropdown">Goto Faction</button>
            <div class="dropdown-menu" aria-labelledby="factionDropdown">
                {% for faction in faction_data['factions'] %}
                <a class="dropdown-item" href="#{{faction.name}}">{{faction.name}}</a>
                {% endfor %}
            </div>
        </div>
        <table class="table table-dark table-condensed mb-0">
            <thead>
                <tr>
                    <th scope="col" class="columnLabel">Faction</th>
                    <th scope="col" class="columnCount">#</th>
                </tr>
            </thead>
            <tbody>
                {% for faction in faction_data['factions'] %}
                <tr>
                    <td class="label pl-4">{{faction.name}}</td>
                    <td clas="count">{{faction.count}}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<script nonce="{{ csp_nonce() }}">
    //Race collapse
    $('#raceCollapse').on('show.bs.collapse', function(){
        $('#classCollapse').collapse('hide');
        $('#factionCollapse').collapse('hide');
    })

    //Class collapse
    $('#classCollapse').on('show.bs.collapse', function(){
        $('#raceCollapse').collapse('hide');
        $('#factionCollapse').collapse('hide');
    })

    //Faction collapse
    $('#factionCollapse').on('show.bs.collapse', function(){
        $('#raceCollapse').collapse('hide');
        $('#classCollapse').collapse('hide');
    })


    //Expand or collapse
    $('#subraceCollapse').click(function(){
        if ($(this).data("closedAll")) {
            $(".subrace-collapse").collapse("show");
        }
        else {
            $(".subrace-collapse").collapse("hide");
        }

        // save last state
        $(this).data("closedAll",!$(this).data("closedAll"));
    });

   //Expand or collapse
    $('#subclassCollapse').click(function(){
        if ($(this).data("closedAll")) {
            $(".subclass-collapse").collapse("show");
        }
        else {
            $(".subclass-collapse").collapse("hide");
        }

        // save last state
        $(this).data("closedAll",!$(this).data("closedAll"));
    });
</script>

{% endblock %}